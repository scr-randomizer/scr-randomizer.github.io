name: Status Updater

on:
  push:
    branches: [ main ]
    
  workflow_dispatch:
    inputs:
      manual_status:
        description: 'Override Status (leave blank for auto-detect)'
        required: false
        default: ''
        type: choice
        options:
          - ''
          - online
          - maintenance
          - down
          - updating

jobs:
  update-status:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Detect Site State
        id: check_state
        run: |
          # 1. Check if the user selected something in the dropdown
          MANUAL_INPUT="${{ github.event.inputs.manual_status }}"
          
          if [ -n "$MANUAL_INPUT" ]; then
            echo "status=$MANUAL_INPUT" >> $GITHUB_OUTPUT
          else
            # 2. If no manual choice, fall back to scanning index.html
            if grep -q "live = true" index.html; then
              echo "status=online" >> $GITHUB_OUTPUT
            else
              echo "status=maintenance" >> $GITHUB_OUTPUT
            fi
          fi

      - name: Update README Badge
        run: |
          STATUS=${{ steps.check_state.outputs.status }}
          # Logic to swap your badge color based on the status
          # (Using sed to find the current status in README and replace it)
          sed -i "s/status-.*-blue/status-${STATUS}-green/g" README.md
